#!/bin/bash

sudo nmap -sn "$1" -oG - \
  | awk '
  BEGIN{ printf "%-15s %-8s %-17s %s\n","IP","LAT","MAC","VENDOR" }
  /^Nmap scan report for /{
    # 直前のホストがまだ出力されていなければ出力（MACが無かったケースのため）
    if (ip && !printed) {
      printf "%-15s %-8s %-17s %s\n", ip, (lat?lat:"-"), "-", "-"
    }
    ip = $NF; lat=""; mac=""; vendor=""; printed=0; next
  }
  /^Host is up/{
    if (match($0,/\([0-9.]+s/)) { lat = substr($0, RSTART+1, RLENGTH-1) } else { lat = "-" }
    next
  }
  /^MAC Address:/{
    mac = $3
    vendor = substr($0, index($0,"(")+1)
    vendor = substr(vendor, 1, length(vendor)-1)
    printf "%-15s %-8s %-17s %s\n", ip, (lat?lat:"-"), mac, vendor
    printed = 1
    next
  }
  END{
    if (ip && !printed) {
      printf "%-15s %-8s %-17s %s\n", ip, (lat?lat:"-"), "-", "-"
    }
  }
  '

