#!/bin/bash

set -ue

branch=$1

git fetch
body=`git log origin/$1...origin/main --pretty=format:"%s" | grep 'Merge pull request' | perl -pe 's/Merge pull request //' | perl -pe 's/^/- /'`

echo $body

url=`gh pr create --title "Production Release" --body "$body" --base "$branch"`

if [ -z "$url" ]; then
    exit 2
fi

if [ `uname` == 'Linux' ]; then
    xdg-open $url
else
    open $url
fi
