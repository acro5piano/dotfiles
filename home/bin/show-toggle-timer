#!/bin/bash

CACHE_FILE=/tmp/__show-toggle-timer-cache

function print() {
  if [ $1 != "no" ]; then
    echo 'ðŸˆº' $1
  fi
}

if [ -e $CACHE_FILE ]; then
  one_min_ago=`date -d '1 minutes ago' '+%s'`
  last_modified=`date -r $CACHE_FILE '+%s'`
  # Cache five minutes.
  if [ $last_modified -gt $one_min_ago ]; then
    print `cat $CACHE_FILE`
    exit 0
  fi
fi

raw_project_name=$(
  toggl view-timer \
    | head -1 \
    | cut -d, -f 8 \
    | awk '{print $2}' \
    | perl -pe 's/"//g' \
    | cut -b 1-64 \
    | tee /tmp/__show-toggle-timer-cache
)

print $raw_project_name
